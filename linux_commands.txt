### --- PAENIBACILLUS BLAST --- ###

# Acquired Paenibacillus genomes April 21, 2025

export PATH=/programs/ncbi_datasets:$PATH

datasets download genome taxon paenibacillus --include genome,protein,gtf --assembly-source refseq --annotated --filename paeni.zip  

# Removed genomes with ≥5% CheckM contamination and/or ≤95% CheckM completeness using a text file of genomes accessions to remove.

xargs -d '\n' -a genomes_to_remove.txt rm –r

# Combined all protein files to make a BLAST database.

for f in proteins/*/protein.faa; do
    accession=$(basename "$(dirname "$f")")
    awk -v a="$accession" '/^>/ {print ">" a "_" substr($0,2); next} {print}' "$f"
done > proteins_unique.faa

makeblastdb -in proteins_unique.faa -dbtype prot -parse_seqids

# Ran PSI-BLAST. B. subtilis protein seqeunces are from SubtiWiki. After running, we decided to use only the first iteration results, which is equivalent to a BLASTP run.

nohup psiblast -query bs_protein_sequences.fasta -db proteins_unique.faa -outfmt 7 -num_iterations 3 -max_target_seqs 10000 -out psi_blast_paeni.csv

# We extracted the first iteration using select_it1.awk
# The following are the contents of select_it1.awk:

/^# Query:/ {
  query = $0
  next
}

/^# Iteration:/ {
  if ($3 == 1) {
    curr_iter = 1
  } else {
    curr_iter = 0
  }
  next
}

/^#/ { next }  # skip other comment lines

{
  if (curr_iter == 1) print
}

# Extracted BLASTP results.

awk -f select_it1.awk psi_blast_paeni.csv > psi_blast_paeni_it1.csv



### --- Spo0F, Spo0B, Spo0A ORTHOLOG ALIGNMENT AND PERCENT IDENTITY --- ###
# Protein accession listed in Table S3

/programs/clustalo -i spo0B-domain_containing.fasta -o spo0B_domain-containing_clustalo.fasta --full --percent-id --distmat-out=spo0B_pid_clustal.csv

/programs/clustalo -i spo0F_for_pid.fasta -o spo0F_clustalo.fasta --full --percent-id --distmat-out=spo0F_pid_clustal.csv

/programs/clustalo -i spo0A_for_pid.fasta -o spo0A_clustalo.fasta --full --percent-id --distmat-out=spo0A_pid_clustal.csv



### ---- CONSERVATION PLOT ALIGNMENT --- ###
# Spo0B_protein_cleaned_2.faa contained 1437 Paenibacillus Spo0B sequences, with lengths 199-279.

/programs/mafft/bin/mafft --op 3 --ep 0.3 Spo0B_protein_cleaned_2.faa > Spo0B_align_op3_ep_3.fasta 